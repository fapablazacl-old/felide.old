
CMAKE_MINIMUM_REQUIRED(VERSION 3.1)

PROJECT (felide)

# Boost
ADD_DEFINITIONS(-DBOOST_ALL_NO_LIB)

SET (Boost_USE_STATIC_LIBS OFF)
SET (Boost_USE_MULTITHREADED ON)
SET (Boost_USE_STATIC_RUNTIME OFF)

SET (CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/cmake)

FIND_PACKAGE (Boost COMPONENTS filesystem system REQUIRED)

# Fix for std::unique_ptr on clang and gcc
IF ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang" OR "${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++1y")
ENDIF()

IF (FELIDE_GUI_TOOLKIT_WIN32XX)
	ADD_DEFINITIONS(-DFELIDE_GUI_TOOLKIT_WIN32XX)

    # Win32xx
    IF (NOT WIN32XX_INCLUDE_DIRS)
        MESSAGE (ERROR_MESSAGE "Win32++ include location isn't defined. Please define the WIN32XX_INCLUDE_DIRS variable.")
        SET (WIN32XX_FOUND 0)
        SET (WIN32XX_LIBRARIES )
    ELSE ()
        SET (WIN32XX_FOUND 1)
        SET (WIN32XX_LIBRARIES comctl32)
    ENDIF ()


	IF (WIN32XX_FOUND)
		IF (NOT SCINTILLA_INCLUDE_DIRS)
		    MESSAGE (WARNING "Scintilla include location isn't defined (-DSCINTILLA_INCLUDE_DIRS). Using raw text editor widget.")
			SET (SCINTILLA_FOUND 0)
			SET (SCINTILLA_LIBRARIES )
		ELSE ()
			SET (SCINTILLA_FOUND 1)
			SET (SCINTILLA_LIBRARIES )
		ENDIF ()
	ENDIF ()

	IF (SCINTILLA_FOUND)
		ADD_DEFINITIONS(-DFELIDE_GUI_CODEEDIT_SCI)
	ELSE ()
		ADD_DEFINITIONS(-DFELIDE_GUI_CODEEDIT_TEXT)
	ENDIF ()

    INCLUDE_DIRECTORIES (${WIN32XX_INCLUDE_DIRS})
	INCLUDE_DIRECTORIES (${SCINTILLA_INCLUDE_DIRS})

    SET (FELIDE_GUI_LIBRARIES ${WIN32XX_LIBRARIES})
ELSEIF (FELIDE_GUI_TOOLKIT_QT5)

	ADD_DEFINITIONS(-DFELIDE_GUI_TOOLKIT_QT5)

    # Qt5Widgets
    SET (CMAKE_INCLUDE_CURRENT_DIR ON)
    SET (CMAKE_AUTOMOC ON)
    FIND_PACKAGE(Qt5Widgets REQUIRED)
    FIND_PACKAGE(QScintilla REQUIRED)

    SET (FELIDE_GUI_LIBRARIES Qt5::Widgets ${QSCINTILLA_LIBRARY})

    INCLUDE_DIRECTORIES(${QSCINTILLA_INCLUDE_DIR})

ELSE ()
    MESSAGE ("No GUI toolkit was selected. Please define one of the following:")
	MESSAGE ("  FELIDE_GUI_TOOLKIT_WIN32XX")
	MESSAGE ("  FELIDE_GUI_TOOLKIT_QT5")
	MESSAGE (FATAL_ERROR "")
ENDIF ()

# Include dirs
INCLUDE_DIRECTORIES (${Boost_INCLUDE_DIRS})
INCLUDE_DIRECTORIES (${PROJECT_SOURCE_DIR}/src)

ADD_SUBDIRECTORY (src/felide)
ADD_SUBDIRECTORY (src/felide.editor)
